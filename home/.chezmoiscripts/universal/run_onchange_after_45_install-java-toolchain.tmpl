{{- if .toolchains.java -}}
#!/usr/bin/env bash

source $HOME/.local/share/shell/env.zsh

{{ template "universal/scripts-library" }}
{{ template "universal/sdkman-library" }}

# {{ includeTemplate "universal/next-update" . }}

if ! sdk version &>/dev/null; then
  log_task "Installing SDKMAN!"

  # chezmoi already created the sdkman dir because of the etc/config file, so we move it temporarily out

  original_sdkman_config="${SDKMAN_DIR}/etc/config"
  temp_sdkman_config="$(mktemp --dry-run --suffix=sdkman_config)"

  mv -f "${original_sdkman_config}" "${temp_sdkman_config}"
  rm -rf "${SDKMAN_DIR}"

  curl -fsSL "https://get.sdkman.io/?rcupdate=false" | bash

  mv -f "${temp_sdkman_config}" "${original_sdkman_config}"
fi

java_version="17"
identifier="$(sdk list java | grep --only-matching --max-count 1 --extended-regexp "\b${java_version}.[0-9]+.[0-9]+(.[0-9]+)?-tem\b")"
if ! sdk current java | grep -q "${identifier}"; then
  log_task "Installing Java ${java_version} with SDKMAN!"
  c sdk install java "${identifier}"
  c sdk default java "${identifier}"
fi

maven_version="3"
identifier="$(sdk list maven | grep --only-matching --extended-regexp "\b${maven_version}.[0-9]+.[0-9]+(.[0-9]+)?\b" | sort --version-sort --reverse | head -n 1)"
if ! sdk current maven | grep -q "${identifier}"; then
  log_task "Installing Maven ${maven_version} with SDKMAN!"
  c sdk install maven "${identifier}"
  c sdk default maven "${identifier}"
fi

{{- end -}}
